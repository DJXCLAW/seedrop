<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Seed Dropper — Self-Contained</title>
<style>
:root { --bar-h: 190px; --accent:#2196f3; }
*{box-sizing:border-box;margin:0;padding:0}
body{height:100vh;display:flex;flex-direction:column;font-family:Segoe UI,Arial,sans-serif;background:#fafafa;color:#222}
#game{flex:1;background:#fff;border-bottom:2px solid var(--accent);width:100%}
#ui{height:var(--bar-h);background:#e0e0e0;border-top:2px solid var(--accent);padding:12px;display:flex;flex-direction:column;gap:8px}
#stats{font-size:15px}
#shop{display:none;gap:10px;flex-wrap:wrap;align-items:center}
.btn{flex:1 1 0;padding:8px 0;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;transition:transform .12s}
.btn:hover:not(.disabled){transform:translateY(-2px)}
.speed{background:#1e88e5;color:#fff}
.slow{background:#43a047;color:#fff}
.bonus{background:#fdd835;color:#000}
.slotTile{background:#673ab7;color:#fff}.common{background:#6a5acd}.rare{background:#3f51b5}.epic{background:#9c27b0}.legendary{background:#ff5722}
.disabled{opacity:.35;cursor:not-allowed}
#del {background:#e53935;width:100px;color:#fff;display:none}
#go  {background:#1976d2;width:110px;color:#fff}
#pending{font-size:13px;opacity:.8;display:none}
#msg {height:18px;color:#d32f2f}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="ui">
  <div id="stats"></div>
  <div id="shop">
    <button id="c0" class="btn"></button>
    <button id="c1" class="btn"></button>
    <button id="c2" class="btn"></button>
  </div>
  <div style="display:flex;gap:10px;align-items:center">
    <button id="del" class="btn" onclick="toggleDelete()">Delete ✂️</button>
    <button id="go"  class="btn" onclick="startNextRound()">Start ▶</button>
  </div>
  <div id="pending"></div>
  <div id="msg"></div>
</div>
<script>
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
const R = 8, BUY = 3, STILL = 60, ROUND = 20000, SLOTS = 12, BAR = 26, SPC = 30, HANDPER = 4;
const DH = 90;

let slotMul = Array(SLOTS).fill(1);
let offers = [], pending = [], bumps = [];
let money = 25, score = 0, quota = 10, bought = 0, boughtC = {}, seed = null;
let inShop = true, delMode = false, preX = null, start = 0;
let flash = { v: 0, t: 0 }, ante = 1, hand = 1, lost = false;

/*** Sprites ***/
const seedImg = new Image();
seedImg.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAk0lEQVRYR+2XwQ3AIAhFb9CdfZ4zXIQHnUSzCjkaTBIxWInhMM2YtWQDEyA4y6J3OlFCKqLVSm8BBKGifFKxARuEELX0bVmEdlyH1psZiLR1+NAhKf5DFmhXnLUFG+ON3RD5uwIZQumta8Cuv92EReTAu8cTdoalObYoIpAvl2TuG0EVHo3c4byQ9Cj2XYAAAAASUVORK5CYII=
'; // paste your base64 seed PNG here
const circImg = new Image();
circImg.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAkUlEQVRYR+2XwQ2AIAxFndAdTZJ0/lQv3AwcgaOkJMkkqgUN4FwMfb8zi7AWfSmAUOCSMqkBiF3nIY2gz1FIpIr4NwK4VaYxEp4AbE43qpoYHxMNRCgqWPCijKMIffRjCkA9yRhCL3BxkI3dS+6tVqfQDhVTG0LpoU7YxU8g+p7on2lGFNnkDfxo9r+0AAAAASUVORK5CYII=
'; // paste your base64 circle bumper PNG here
let seedOk = true, circOk = true;

/*** Bumper Definitions ***/
const bumpers = [
  { k: 'b', id: 'speed', effect: 'speed', r: 12, v: 3, c: 6, col: '#1e88e5', n: 'Speed Boost' },
  { k: 'b', id: 'slow', effect: 'slow', r: 12, v: 4, c: 7, col: '#43a047', n: 'Slow Down' },
  { k: 'b', id: 'bonus', effect: 'bonus', r: 12, v: 6, c: 9, col: '#fdd835', n: 'Bonus Points' }
];

const tiles = [
  { k: 's', id: 't125', m: 1.25, c: 6, n: '1.25×', rar: 'common' },
  { k: 's', id: 't150', m: 1.5, c: 9, n: '1.5×', rar: 'rare' },
  { k: 's', id: 't200', m: 2.0, c: 14, n: '2×', rar: 'epic' },
  { k: 's', id: 't300', m: 3.0, c: 22, n: '3×', rar: 'legendary' }
];

const RAR = { common: 60, rare: 25, epic: 12, legendary: 3 };
const key = c => c.k + ':' + c.id;

function pick() {
  const arr = [];
  bumpers.forEach(b => arr.push({ c: b, w: 40 }));
  tiles.forEach(t => arr.push({ c: t, w: RAR[t.rar] || 1 }));
  let tot = arr.reduce((s, o) => s + o.w, 0), r = Math.random() * tot;
  for (const o of arr) if ((r -= o.w) <= 0) return structuredClone(o.c);
  return structuredClone(arr[0].c);
}

class Seed {
  constructor(x) {
    this.x = x; this.y = R + 4;
    this.vx = 0; this.vy = 2;
    this.val = 0; this.still = 0;
    this.last = null;
  }

  upd() {
    this.vy += 0.35;
    this.x += this.vx;
    this.y += this.vy;
    if (this.x < R) { this.x = R; this.vx = Math.abs(this.vx) * 0.7; }
    if (this.x > cvs.width - R) { this.x = cvs.width - R; this.vx = -Math.abs(this.vx) * 0.7; }
    if (Math.abs(this.vx) < 0.05) this.vx += (Math.random() < 0.5 ? -1 : 1) * 0.15;
    this.col();
    const s = Math.hypot(this.vx, this.vy);
    this.still = (this.y > DH && s < 0.12) ? this.still + 1 : 0;
  }

  col() {
    for (const b of bumps) {
      const dx = this.x - b.x, dy = this.y - b.y, d = Math.hypot(dx, dy);
      if (d < R + b.r) {
        const nx = dx / d, ny = dy / d, ov = R + b.r - d + 0.5;
        this.x += nx * ov; this.y += ny * ov;
        const dot = this.vx * nx + this.vy * ny;
        this.vx = (this.vx - 2 * dot * nx) * 0.7;
        this.vy = (this.vy - 2 * dot * ny) * 0.7;
        if (b !== this.last) {
          score += b.v; this.val += b.v;
          if (b.effect === 'speed') { this.vx *= 1.2; this.vy *= 1.2; }
          if (b.effect === 'slow') { this.vx *= 0.8; this.vy *= 0.8; }
          if (b.effect === 'bonus') { score += 5; this.val += 5; }
          flash = { v: b.v + (b.effect === 'bonus' ? 5 : 0), t: performance.now() };
          this.last = b;
        }
      }
    }
    if (this.last && Math.hypot(this.x - this.last.x, this.y - this.last.y) > R + this.last.r) this.last = null;
  }

  draw() {
    if (seedOk) {
      ctx.drawImage(seedImg, this.x - R, this.y - R, R * 2, R * 2);
    } else {
      ctx.beginPath();
      ctx.arc(this.x, this.y, R, 0, Math.PI * 2);
      ctx.fillStyle = '#4caf50';
      ctx.fill();
    }
  }
}

class Bump {
  constructor(x, y, c) {
    Object.assign(this, { x, y, r: c.r, v: c.v, effect: c.effect, col: c.col });
  }

  draw() {
    ctx.save(); ctx.translate(this.x, this.y);
    if (circOk) {
      ctx.drawImage(circImg, -this.r, -this.r, this.r * 2, this.r * 2);
    } else {
      ctx.fillStyle = this.col;
      ctx.beginPath();
      ctx.arc(0, 0, this.r, 0, Math.PI * 2);
      ctx.fill();
    }
    ctx.restore();
  }
}

function startNextRound() {
  if (seed || lost) return;
  if (inShop) { inShop = false; delMode = false; ui(); }
}

function nextQuota() {
  quota = Math.round(10 * Math.pow(1.12, ante - 1) * (1 + 0.06 * (hand - 1)));
}

function end() {
  if (seed) {
    const w = cvs.width / SLOTS, idx = Math.floor(seed.x / w);
    const gain = Math.round(seed.val * slotMul[idx]);
    money += gain;
    flash = { v: gain, t: performance.now() };
  }
  seed = null; inShop = true; pending.length = 0; score = 0;
  if (money < quota) { lost = true; return; }
  hand++;
  if (hand > HANDPER) { ante++; hand = 1; bumps.length = 0; }
  nextQuota(); deal(); ui();
}

function deal() {
  offers = Array.from({ length: 3 }, pick);
  bought = 0; boughtC = {};
}

function ui() {
  // Your UI update logic here (optional based on your environment)
}

function draw() {
  ctx.clearRect(0, 0, cvs.width, cvs.height);
  ctx.fillStyle = 'rgba(33,150,243,.15)';
  ctx.fillRect(0, 0, cvs.width, DH);

  bumps.forEach(b => b.draw());
  if (seed) {
    seed.upd(); seed.draw();
    const el = performance.now() - start;
    const pct = Math.max(0, 1 - el / ROUND);
    ctx.fillStyle = 'rgba(255,0,0,.35)';
    ctx.fillRect(0, cvs.height - 6, cvs.width * pct, 6);
    if (el > ROUND || seed.y > cvs.height || seed.still > STILL) end();
  }

  if (performance.now() - flash.t < 1000) {
    ctx.font = '20px Segoe UI'; ctx.fillStyle = '#2e7d32';
    ctx.fillText(`+$${flash.v}`, 10, 30);
  }

  requestAnimationFrame(draw);
}

function fit() {
  cvs.width = window.innerWidth;
  cvs.height = window.innerHeight - 190; // match your CSS --bar-h
}
window.addEventListener('resize', fit);
fit();

nextQuota();
deal();
ui();
requestAnimationFrame(draw);

</script>
</body>
</html>
